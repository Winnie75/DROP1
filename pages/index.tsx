import styles from "../styles/Home.module.css";
import Head from "next/head";
import {ProtectedRoute} from "../components/ProtectedRoute/ProtectedRoute";
import {useQuery} from "react-query";
import {useAuth} from "../context/AuthContext";
import {getItems} from "../components/api";
import {ProductList} from "../components/ProductsList/ProductList";


export default function Index() {
    const {currentUser} = useAuth();

    const {data, isLoading, isError} = useQuery('items', () => getItems(currentUser), {
        enabled: !!currentUser
    });

    return (
        <ProtectedRoute type={'onlyAuth'}>
            <div className={styles.container}>
                <Head>
                    <title>Qr id | Your items</title>
                    <meta name="description" content="Generated by create next app"/>
                    <link rel="icon" href="/favicon.ico"/>
                </Head>

                <main style={{
                    minHeight: '85vh',
                }}>

                    {isLoading && <p>Loading...</p>}

                    {isError && <p>Error</p>}

                    {data && <ProductList products={data.items} customerId={data.customerId}/>}

                </main>

            </div>
        </ProtectedRoute>
    );
}